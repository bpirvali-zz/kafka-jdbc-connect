--------------------------------
-- DDLs
--------------------------------
DROP TABLE DFOCUSVW.T1;
CREATE TABLE DFOCUSVW.T1(
    COL1 VARCHAR(100) NOT null,
    Td_Update_Ts timestamp NOT null,
    PRIMARY KEY (col1)
    );

DROP TABLE DFOCUSVW.T2;
CREATE TABLE DFOCUSVW.T2(
    COL1 VARCHAR(100) NOT null,
    Td_Update_Ts timestamp NOT null,
    PRIMARY KEY (col1)
    );


DROP TABLE DFOCUSVW.T3;
CREATE TABLE DFOCUSVW.T3(
    COL1 VARCHAR(100) NOT NULL,
    offset_id INTEGER,
    PRIMARY KEY (col1)
    );

DROP TABLE DFOCUSVW.META_LOAD_STATUS;
CREATE TABLE DFOCUSVW.META_LOAD_STATUS (
    Subject_Area_Nm VARCHAR(100),
    DB_Table_Nm varchar(200) NOT NULL,
    Table_Max_Td_Update_Ts timestamp,
    Table_Max_Td_Update_Id INTEGER,
    insert_ts timestamp NOT NULL DEFAULT now(),
    update_ts timestamp NOT NULL DEFAULT now(),
    PRIMARY KEY (DB_Table_Nm)
);


DROP TABLE DFOCUSVW.offsets_table;
CREATE TABLE DFOCUSVW.offsets_table (
    topic_prefix varchar(100) NOT NULL,
    table_name varchar(100) NOT NULL,
    last_completed_ts timestamp,
    last_completed_id INTEGER,
    insert_ts timestamp NOT NULL DEFAULT now(),
    update_ts timestamp NOT NULL DEFAULT now(),
    PRIMARY KEY (topic_prefix, table_name)
);

--------------------------------
-- INSERT - META_LOAD_STATUS 
--------------------------------
INSERT INTO DFOCUSVW.META_LOAD_STATUS (DB_Table_Nm, Table_Max_Td_Update_Ts)
VALUES('DFOCUSVW.T1', '2020-03-05 00:00:00.000000 +00:00');
INSERT INTO DFOCUSVW.META_LOAD_STATUS (DB_Table_Nm, Table_Max_Td_Update_Ts)
VALUES('DFOCUSVW.T2', '2020-03-05 00:00:01.000000 +00:00');
-- id --
INSERT INTO DFOCUSVW.META_LOAD_STATUS (DB_Table_Nm, table_max_td_update_id)
VALUES('DFOCUSVW.T3', -10000);

INSERT INTO DFOCUSVW.META_LOAD_STATUS (table_nm, table_max_td_update_id)
VALUES('DFOCUSVW.CTRY', -3015);

--------------------------------
-- INSERT T1
--------------------------------
INSERT INTO DFOCUSVW.t1 VALUES('x1','2020-03-05 00:00:00.000000 +00:00');
INSERT INTO DFOCUSVW.t1 VALUES('x2','2020-03-05 00:00:00.000000 +00:00');
INSERT INTO DFOCUSVW.t1 VALUES('x3','2020-03-05 00:00:00.000000 +00:00');
INSERT INTO DFOCUSVW.t1 VALUES('x4','2020-03-05 00:00:01.000000 +00:00');
INSERT INTO DFOCUSVW.t1 VALUES('x5','2020-03-05 00:00:01.000000 +00:00');
INSERT INTO DFOCUSVW.t1 VALUES('x6','2020-03-05 00:00:01.000000 +00:00');
INSERT INTO DFOCUSVW.t1 VALUES('x7','2020-03-05 00:00:02.000000 +00:00');
INSERT INTO DFOCUSVW.t1 VALUES('x8','2020-03-05 00:00:02.000000 +00:00');
INSERT INTO DFOCUSVW.t1 VALUES('x9','2020-03-05 00:00:02.000000 +00:00');
INSERT INTO DFOCUSVW.t1 VALUES('x10','2020-03-05 00:00:03.000000 +00:00');
INSERT INTO DFOCUSVW.t1 VALUES('x11','2020-03-05 00:00:03.000000 +00:00');
INSERT INTO DFOCUSVW.t1 VALUES('x12','2020-03-05 00:00:03.000000 +00:00');
INSERT INTO DFOCUSVW.t1 VALUES('x13','2020-03-05 00:00:04.000000 +00:00');
INSERT INTO DFOCUSVW.t1 VALUES('x14','2020-03-05 00:00:04.000000 +00:00');
INSERT INTO DFOCUSVW.t1 VALUES('x15','2020-03-05 00:00:04.000000 +00:00');
INSERT INTO DFOCUSVW.t1 VALUES('x16','2020-03-05 00:00:05.000000 +00:00');
INSERT INTO DFOCUSVW.t1 VALUES('x17','2020-03-05 00:00:05.000000 +00:00');
INSERT INTO DFOCUSVW.t1 VALUES('x18','2020-03-05 00:00:05.000000 +00:00');
INSERT INTO DFOCUSVW.t1 VALUES('x19','2020-03-05 00:00:06.000000 +00:00');
INSERT INTO DFOCUSVW.t1 VALUES('x20','2020-03-05 00:00:06.000000 +00:00');
INSERT INTO DFOCUSVW.t1 VALUES('x21','2020-03-05 00:00:06.000000 +00:00');

--------------------------------
-- INSERT T2
--------------------------------
INSERT INTO DFOCUSVW.t2 VALUES('x1','2020-03-05 00:00:00.000000 +00:00');
INSERT INTO DFOCUSVW.t2 VALUES('x2','2020-03-05 00:00:00.000000 +00:00');
INSERT INTO DFOCUSVW.t2 VALUES('x3','2020-03-05 00:00:00.000000 +00:00');
INSERT INTO DFOCUSVW.t2 VALUES('x4','2020-03-05 00:00:01.000000 +00:00');
INSERT INTO DFOCUSVW.t2 VALUES('x5','2020-03-05 00:00:01.000000 +00:00');
INSERT INTO DFOCUSVW.t2 VALUES('x6','2020-03-05 00:00:01.000000 +00:00');
INSERT INTO DFOCUSVW.t2 VALUES('x7','2020-03-05 00:00:02.000000 +00:00');
INSERT INTO DFOCUSVW.t2 VALUES('x8','2020-03-05 00:00:02.000000 +00:00');
INSERT INTO DFOCUSVW.t2 VALUES('x9','2020-03-05 00:00:02.000000 +00:00');
INSERT INTO DFOCUSVW.t2 VALUES('x10','2020-03-05 00:00:03.000000 +00:00');
INSERT INTO DFOCUSVW.t2 VALUES('x11','2020-03-05 00:00:03.000000 +00:00');
INSERT INTO DFOCUSVW.t2 VALUES('x12','2020-03-05 00:00:03.000000 +00:00');
INSERT INTO DFOCUSVW.t2 VALUES('x13','2020-03-05 00:00:04.000000 +00:00');
INSERT INTO DFOCUSVW.t2 VALUES('x14','2020-03-05 00:00:04.000000 +00:00');
INSERT INTO DFOCUSVW.t2 VALUES('x15','2020-03-05 00:00:04.000000 +00:00');
INSERT INTO DFOCUSVW.t2 VALUES('x16','2020-03-05 00:00:05.000000 +00:00');
INSERT INTO DFOCUSVW.t2 VALUES('x17','2020-03-05 00:00:05.000000 +00:00');
INSERT INTO DFOCUSVW.t2 VALUES('x18','2020-03-05 00:00:05.000000 +00:00');
INSERT INTO DFOCUSVW.t2 VALUES('x19','2020-03-05 00:00:06.000000 +00:00');
INSERT INTO DFOCUSVW.t2 VALUES('x20','2020-03-05 00:00:06.000000 +00:00');
INSERT INTO DFOCUSVW.t2 VALUES('x21','2020-03-05 00:00:06.000000 +00:00');

--------------------------------
-- INSERT T3
--------------------------------
INSERT INTO DFOCUSVW.t3 VALUES('x1', -5000);
INSERT INTO DFOCUSVW.t3 VALUES('x2', -5000);
INSERT INTO DFOCUSVW.t3 VALUES('x3', -5000);
INSERT INTO DFOCUSVW.t3 VALUES('x4', -4000);
INSERT INTO DFOCUSVW.t3 VALUES('x5', -4000);
INSERT INTO DFOCUSVW.t3 VALUES('x6', -4000);
INSERT INTO DFOCUSVW.t3 VALUES('x7', -3000);
INSERT INTO DFOCUSVW.t3 VALUES('x8', -3000);
INSERT INTO DFOCUSVW.t3 VALUES('x9', -3000);
INSERT INTO DFOCUSVW.t3 VALUES('x10', -2000);
INSERT INTO DFOCUSVW.t3 VALUES('x11', -2000);
INSERT INTO DFOCUSVW.t3 VALUES('x12', -2000);
INSERT INTO DFOCUSVW.t3 VALUES('x13', -1000);
INSERT INTO DFOCUSVW.t3 VALUES('x14', -1000);
INSERT INTO DFOCUSVW.t3 VALUES('x15', -1000);
INSERT INTO DFOCUSVW.t3 VALUES('x16', 0);
INSERT INTO DFOCUSVW.t3 VALUES('x17', 0);
INSERT INTO DFOCUSVW.t3 VALUES('x18', 0);
INSERT INTO DFOCUSVW.t3 VALUES('x19', 1000);
INSERT INTO DFOCUSVW.t3 VALUES('x20', 1000);
INSERT INTO DFOCUSVW.t3 VALUES('x21', 1000);


--------------------------------
-- DMLs
--------------------------------
DELETE FROM DFOCUSVW.t1;
DELETE FROM DFOCUSVW.t2;
DELETE FROM DFOCUSVW.t3;
DELETE FROM DFOCUSVW.META_LOAD_STATUS;
DELETE FROM DFOCUSVW.offsets_table;

UPDATE DFOCUSVW.META_LOAD_STATUS
SET
   table_max_td_update_ts = '2020-03-05 00:00:03.000000 +00:00'
   , update_ts = current_timestamp
WHERE table_nm = 'DFOCUSVW.T1';

UPDATE DFOCUSVW.META_LOAD_STATUS
SET
   table_max_td_update_ts = '2020-03-05 00:00:01.000000 +00:00'
   , update_ts = current_timestamp
WHERE Db_table_nm = 'DFOCUSVW.T2' ;

UPDATE DFOCUSVW.META_LOAD_STATUS
SET
   table_max_td_update_id = -3000
   , update_ts = current_timestamp
WHERE Db_table_nm = 'DFOCUSVW.T3' ;

UPDATE DFOCUSVW.offsets_table 
SET
   last_completed_id = -4001
   , update_ts = current_timestamp
WHERE table_name = 'DFOCUSVW.T3' ;

--------------------------------
-- SELECTs
--------------------------------
SELECT * FROM DFOCUSVW.t1 a ORDER BY a.Td_Update_Ts, col1;
SELECT * FROM DFOCUSVW.t2 a ORDER BY a.Td_Update_Ts, col1;
SELECT * FROM DFOCUSVW.t3 a ORDER BY a.offset_id, col1;

-- meta_load_status --
SELECT db_table_nm, table_max_td_update_ts, table_max_td_update_id 
FROM DFOCUSVW.meta_load_status a ORDER BY db_table_nm;

-- offsets_table --
SELECT topic_prefix, table_name, last_completed_ts, last_completed_id 
FROM DFOCUSVW.offsets_table a ORDER BY a.topic_prefix, table_name ;

DELETE FROM DFOCUSVW.offsets_table 
WHERE table_name = 'DFOCUSVW.T3';
--------------------------------
--------------------------------
--------------------------------
